(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[429],{63:(e,t,s)=>{"use strict";var a=s(7260);s.o(a,"useRouter")&&s.d(t,{useRouter:function(){return a.useRouter}})},832:(e,t,s)=>{Promise.resolve().then(s.bind(s,1840))},1049:(e,t,s)=>{"use strict";s.d(t,{j:()=>l});var a=s(2115);function l(){let[e,t]=(0,a.useState)(0),[s,l]=(0,a.useState)([]),[r,i]=(0,a.useState)(!1);(0,a.useEffect)(()=>{let e=sessionStorage.getItem("blackjack_guest_chips"),s=sessionStorage.getItem("blackjack_guest_history");e?t(parseInt(e,10)):t(0),s&&l(JSON.parse(s)),i(!0)},[]),(0,a.useEffect)(()=>{r&&sessionStorage.setItem("blackjack_guest_chips",e.toString())},[e,r]),(0,a.useEffect)(()=>{r&&sessionStorage.setItem("blackjack_guest_history",JSON.stringify(s))},[s,r]);let n=async s=>!(e<s)&&(t(e=>e-s),!0);return{guestChips:e,guestHistory:s,isLoaded:r,deductGuestChips:n,addGuestChips:async e=>{t(t=>t+e)},addGuestHistory:e=>{l(t=>[...t,e])},resetGuestData:()=>{sessionStorage.removeItem("blackjack_guest_history"),sessionStorage.removeItem("blackjack_guest_chips"),t(0),l([])}}}},1840:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>h});var a=s(5155),l=s(63),r=s(6489),i=s(2115),n=s(9379),c=s(2735),o=s(5471),d=s(2944),x=s(1049);function h(){var e,t;let s=(0,l.useRouter)(),{data:h}=(0,r.useSession)(),m=null==h||null==(e=h.user)?void 0:e.email,u=!(null==h||null==(t=h.user)?void 0:t.email),[p,g]=(0,i.useState)(!1),{guestChips:f,guestHistory:y,isLoaded:b,addGuestChips:j}=(0,x.j)(),{currentChips:N,refetchChips:v}=(0,o.z)(m,f,b),{history:k,loading:w,error:S,currentPage:C,totalPages:_,goToPage:E,refetchHistory:P}=(0,d.a)(u?void 0:m);(0,i.useEffect)(()=>{!u&&m&&P()},[]);let[B,F]=(0,i.useState)(1),O=(u?y:k).slice().sort((e,t)=>t.timestamp-e.timestamp),T=u?B:C,R=u?Math.ceil(O.length/10):_,G=e=>{u?F(e):E(e)},L=u?O.slice((T-1)*10,10*T):O,D=O.length,[I,A]=(0,i.useState)(!1);return((0,i.useEffect)(()=>A(!0),[]),I)?(0,a.jsxs)("div",{className:"min-h-screen bg-[#fccfcf]",children:[(0,a.jsx)(n.A,{chips:N,onHistoryClick:()=>s.push("/history"),onBuyChipsClick:()=>g(!0)}),(0,a.jsx)("main",{className:"max-w-6xl mx-auto px-6 py-12",children:(0,a.jsxs)("div",{className:"bg-white rounded-2xl border border-gray-100 p-12 shadow-sm",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-8",children:[(0,a.jsx)("h2",{className:"text-2xl font-light text-gray-800",children:"Game History"}),(0,a.jsx)("button",{type:"button",onClick:()=>s.push("/"),className:"text-gray-400 hover:text-gray-600 transition-colors text-sm",children:"← Back to Game"})]}),u&&(0,a.jsx)("div",{className:"mb-6 text-center p-4 bg-gray-50 rounded-lg",children:(0,a.jsxs)("p",{className:"text-xs text-gray-500",children:["Playing as Guest •",(0,a.jsx)("button",{onClick:()=>{},className:"text-[#ffb5c0] hover:underline ml-1",children:"Sign in"})," to sync across devices"]})}),w&&(0,a.jsx)("div",{className:"text-gray-400 text-center py-12",children:(0,a.jsx)("p",{className:"text-sm",children:"Loading history..."})}),S&&(0,a.jsx)("div",{className:"text-red-400 text-center py-12",children:(0,a.jsx)("p",{className:"text-sm",children:S})}),0===L.length&&!w&&(0,a.jsxs)("div",{className:"text-gray-400 text-center py-12",children:[(0,a.jsx)("p",{className:"text-sm",children:"No games played yet"}),(0,a.jsx)("p",{className:"text-xs mt-2",children:"Your game history will appear here"})]}),L.length>0&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"space-y-3",children:L.map(e=>{var t;return(0,a.jsx)("div",{className:"border border-gray-100 rounded-lg p-6 hover:border-[#ffb5c0]/30 transition-colors",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-xs text-gray-400 mb-1",children:"Date"}),(0,a.jsx)("p",{className:"text-sm text-gray-700 font-light",children:new Date(e.timestamp).toLocaleString("en-US",{month:"short",day:"numeric",year:"numeric",hour:"2-digit",minute:"2-digit"})})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-xs text-gray-400 mb-1",children:"Bet"}),(0,a.jsxs)("p",{className:"text-sm text-gray-700 font-light",children:[e.bet," chips"]})]})]}),(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsxs)("div",{className:"w-48",children:[(0,a.jsx)("p",{className:"text-xs text-gray-400 mb-1",children:"Score"}),(0,a.jsxs)("p",{className:"text-sm text-gray-700 font-light",children:["You:"," ",(0,a.jsx)("span",{className:"text-[#ffb5c0] font-medium",children:e.playerTotal||0}),(0,a.jsx)("span",{className:"mx-2 text-gray-300",children:"|"}),"Dealer:"," ",(0,a.jsx)("span",{className:"text-gray-500 font-medium",children:e.dealerTotal||0})]})]}),(0,a.jsxs)("div",{className:"w-32 text-left",children:[(0,a.jsx)("p",{className:"text-xs text-gray-400 mb-1",children:"Result"}),(0,a.jsx)("span",{className:"inline-block px-3 py-1 rounded-full text-xs font-medium text-right ".concat("win"===(t=e.result)||"blackjack"===t?"bg-green-100 text-green-700":"lose"===t?"bg-red-100 text-red-700":"bg-yellow-100 text-yellow-700"),children:"blackjack"===e.result?"Blackjack (+".concat(e.winnings,")"):"win"===e.result?"Win (+".concat(e.winnings,")"):"lose"===e.result?"Lose":"Push"})]})]})]})},e.id)})}),R>1&&(0,a.jsxs)("div",{className:"flex justify-center items-center gap-2 mt-8",children:[(0,a.jsx)("button",{onClick:()=>G(T-1),disabled:1===T,className:"px-3 py-1.5 text-sm text-gray-600 hover:text-gray-900 disabled:opacity-30 disabled:cursor-not-allowed transition-colors",children:"← Prev"}),(()=>{let e=[];if(R<=7)for(let t=1;t<=R;t++)e.push(t);else if(T<=4){for(let t=1;t<=5;t++)e.push(t);e.push("..."),e.push(R)}else if(T>=R-3){e.push(1),e.push("...");for(let t=R-4;t<=R;t++)e.push(t)}else{e.push(1),e.push("...");for(let t=T-1;t<=T+1;t++)e.push(t);e.push("..."),e.push(R)}return e})().map((e,t)=>"..."===e?(0,a.jsx)("span",{className:"px-2 text-gray-400",children:"..."},"ellipsis-".concat(t)):(0,a.jsx)("button",{onClick:()=>G(e),className:"px-3 py-1.5 text-sm rounded transition-colors ".concat(T===e?"bg-[#ffb5c0] text-white":"text-gray-600 hover:bg-gray-100"),children:e},e)),(0,a.jsx)("button",{onClick:()=>G(T+1),disabled:T===R,className:"px-3 py-1.5 text-sm text-gray-600 hover:text-gray-900 disabled:opacity-30 disabled:cursor-not-allowed transition-colors",children:"Next →"})]}),(0,a.jsx)("div",{className:"mt-8 pt-6 border-t border-gray-100",children:(0,a.jsxs)("div",{className:"flex justify-between items-center text-sm",children:[(0,a.jsxs)("span",{className:"text-gray-400",children:["Showing ",(T-1)*10+1,"-",Math.min(10*T,D)," of ",D," games"]}),(0,a.jsxs)("div",{className:"flex gap-4",children:[(0,a.jsxs)("span",{className:"text-gray-400",children:["Blackjacks: ",(0,a.jsx)("span",{className:"text-purple-600",children:L.filter(e=>"blackjack"===e.result).length})]}),(0,a.jsxs)("span",{className:"text-gray-400",children:["Wins: ",(0,a.jsx)("span",{className:"text-green-600",children:L.filter(e=>"win"===e.result).length})]}),(0,a.jsxs)("span",{className:"text-gray-400",children:["Losses: ",(0,a.jsx)("span",{className:"text-red-600",children:L.filter(e=>"lose"===e.result).length})]}),(0,a.jsxs)("span",{className:"text-gray-400",children:["Pushes: ",(0,a.jsx)("span",{className:"text-yellow-600",children:L.filter(e=>"push"===e.result).length})]})]})]})})]})]})}),(0,a.jsx)(c.A,{isOpen:p,onClose:()=>g(!1),username:m,isGuest:u,onSuccess:()=>{v()},onGuestAddChips:j})]}):(0,a.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-gray-50 to-gray-100"})}},2735:(e,t,s)=>{"use strict";s.d(t,{A:()=>r});var a=s(5155),l=s(2115);function r(e){let{isOpen:t,onClose:s,username:r,isGuest:i=!1,onSuccess:n,onGuestAddChips:c}=e,[o,d]=(0,l.useState)(100),[x,h]=(0,l.useState)(!1),m=async()=>{if(!(o<=0)&&(r||i)){h(!0);try{if(i&&c)await c(o);else if(r){let e=await fetch("/api/chips/buy",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:r,amount:o})});if(!e.ok)throw Error("Failed to buy chips");let t=await e.json();n&&n(t.newBalance)}s()}catch(e){console.error("Failed to buy chips:",e)}finally{h(!1)}}};return t?(0,a.jsxs)("div",{className:"fixed inset-0 z-50 flex items-center justify-center",children:[(0,a.jsx)("div",{className:"fixed inset-0 bg-black/30",onClick:s}),(0,a.jsxs)("div",{className:"bg-white rounded-2xl p-8 z-10 w-full max-w-md shadow-lg relative",children:[(0,a.jsx)("button",{onClick:s,className:"absolute top-4 right-4 text-gray-400 hover:text-gray-600 text-xl font-bold",children:"\xd7"}),(0,a.jsx)("h2",{className:"text-2xl font-light text-gray-800 mb-6",children:"Buy Chips"}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm text-gray-600 mb-3",children:"Select Amount"}),(0,a.jsx)("div",{className:"grid grid-cols-2 gap-3",children:[100,500,1e3,5e3].map(e=>(0,a.jsxs)("button",{onClick:()=>d(e),className:"py-3 px-4 rounded-lg border-2 transition-colors ".concat(o===e?"border-[#ffb5c0] bg-[#ffb5c0]/10 text-[#ffb5c0]":"border-gray-200 hover:border-gray-300"),children:[e," chips"]},e))})]}),(0,a.jsx)("button",{onClick:m,disabled:x||o<=0,className:"w-full py-3 bg-pink-600 text-white rounded-lg hover:bg-pink-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:"Buy"})]})]})]}):null}},2944:(e,t,s)=>{"use strict";s.d(t,{a:()=>l});var a=s(2115);function l(e){let[t,s]=(0,a.useState)([]),[l,r]=(0,a.useState)(!0),[i,n]=(0,a.useState)(null),[c,o]=(0,a.useState)(1),[d,x]=(0,a.useState)(1),[h,m]=(0,a.useState)(null),u=(0,a.useCallback)(async function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;if(!e)return void r(!1);r(!0),n(null);try{var a;let l=new URLSearchParams({username:e,limit:"10"});h&&l.append("lastKey",h);let r=await fetch("/api/history?".concat(l)),i=await r.json();s(i.games||[]),x(Math.ceil((null!=(a=i.count)?a:0)/10)),o(t),m(i.lastKey||null)}catch(e){console.error("Failed to fetch history:",e),n("Failed to fetch game history")}finally{r(!1)}},[e,h]),p=async e=>{try{(await fetch("/api/game/save",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})).ok&&u(1)}catch(e){console.error("Failed to save game:",e)}};return(0,a.useEffect)(()=>{u(1)},[e]),{history:t,loading:l,error:i,currentPage:c,totalPages:d,goToPage:e=>{u(e)},saveGame:p,refetchHistory:()=>{u(c)}}}},5471:(e,t,s)=>{"use strict";s.d(t,{z:()=>l});var a=s(2115);function l(e,t,s){let[l,r]=(0,a.useState)(0),[i,n]=(0,a.useState)(!0),c=!e||e.startsWith("guest-");return(0,a.useEffect)(()=>{c&&s&&(r(null!=t?t:0),n(!1))},[t,s,c]),(0,a.useEffect)(()=>{!c&&e&&(n(!0),fetch("/api/chips/balance?username=".concat(e)).then(e=>e.json()).then(t=>{var s;console.log("Fetched chips for",e,":",t.chips),r(null!=(s=t.chips)?s:0)}).catch(e=>{console.error("Failed to fetch chips:",e),r(0)}).finally(()=>{n(!1)}))},[e,c]),{currentChips:l,loading:i,refetchChips:()=>{if(c&&s){r(null!=t?t:0),n(!1);return}if(!e){r(0),n(!1);return}n(!0),fetch("/api/chips/balance?username=".concat(e)).then(e=>e.json()).then(t=>{var s;console.log("Fetched chips for",e,":",t.chips),r(null!=(s=t.chips)?s:0)}).catch(e=>{console.error("Failed to fetch chips:",e),r(0)}).finally(()=>{n(!1)})}}}},9379:(e,t,s)=>{"use strict";s.d(t,{A:()=>n});var a=s(5155),l=s(2115),r=s(63),i=s(6489);function n(e){let{chips:t,onHistoryClick:s,onBuyChipsClick:n}=e,c=(0,r.useRouter)(),{data:o}=(0,i.useSession)(),d=(0,l.useRef)(t),[x,h]=(0,l.useState)(!1),m=(0,l.useRef)(null);(0,l.useEffect)(()=>(t>d.current&&(h(!0),m.current=setTimeout(()=>h(!1),600)),d.current=t,()=>{m.current&&clearTimeout(m.current)}),[t]);let u=()=>c.push("/");return(0,a.jsx)("nav",{className:"bg-white/10 backdrop-blur-lg border-b border-white/20",children:(0,a.jsxs)("div",{className:"max-w-6xl mx-auto px-3 sm:px-6 py-3 sm:py-4 flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 sm:gap-4 md:gap-8",children:[(0,a.jsxs)("button",{onClick:u,className:"text-lg sm:text-xl md:text-2xl font-bold text-black hover:text-pink-200 transition-colors tracking-tight",children:["♠",(0,a.jsx)("span",{className:"hidden sm:inline",children:" Blackjack"})]}),t>=0&&(0,a.jsxs)("div",{className:"flex items-center gap-1 sm:gap-2 px-2 sm:px-4 py-1.5 sm:py-2 rounded-full bg-gradient-to-r from-pink-500 to-pink-600",children:[(0,a.jsx)("span",{className:"text-base sm:text-xl",children:"\uD83D\uDCB0"}),(0,a.jsxs)("span",{className:"text-white text-sm sm:text-base font-semibold ".concat(x?"animate-pulse":""),children:["$",t.toLocaleString()]}),n&&(0,a.jsx)("button",{onClick:n,className:"ml-1 sm:ml-2 w-5 h-5 sm:w-6 sm:h-6 flex items-center justify-center rounded-full bg-white/30 hover:bg-white/40 text-white text-sm sm:text-base font-bold transition-all",children:"+"})]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-1 sm:gap-2 md:gap-4",children:[(0,a.jsx)("button",{onClick:u,className:"px-2 sm:px-4 py-1.5 sm:py-2 text-xs sm:text-sm md:text-base text-black hover:text-white font-medium transition-colors",children:"Home"}),(0,a.jsx)("button",{onClick:()=>{if(s)return s();c.push("/history")},className:"px-2 sm:px-4 py-1.5 sm:py-2 text-xs sm:text-sm md:text-base text-black hover:text-white font-medium transition-colors",children:"History"}),o?(0,a.jsx)("button",{onClick:()=>(0,i.signOut)(),className:"px-3 sm:px-6 py-1.5 sm:py-2 bg-white/20 hover:bg-white/30 text-white text-xs sm:text-sm md:text-base rounded-full font-medium transition-all",children:"Logout"}):(0,a.jsx)("button",{onClick:()=>c.push("/login"),className:"px-3 sm:px-6 py-1.5 sm:py-2 bg-gradient-to-r from-pink-500 to-pink-600 hover:from-pink-600 hover:to-pink-700 text-white text-xs sm:text-sm md:text-base rounded-full font-medium transition-all",children:"Login"})]})]})})}}},e=>{e.O(0,[489,441,255,358],()=>e(e.s=832)),_N_E=e.O()}]);